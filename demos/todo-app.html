<!-- A tiny HTMS Todo app: compile to JS, open in a browser, and type away. -->

<var name="state" value='{"todos":[]}' mutable="true"></var>

<div id="todoApp">
  <h2>HTMS Todo</h2>
  <input type="text" id="newTodo" placeholder="Add a task" />
  <button id="addBtn">Add</button>
  <ul id="list"></ul>
</div>

<event target="#addBtn" type="click" action="addTodo()"></event>
<event target="#newTodo" type="keypress" action="onEnter(event)"></event>

<function name="onEnter" params="event">
  if (event.key === 'Enter') { addTodo(); }
  // else ignore
  return;
</function>

<function name="render">
  const list = document.getElementById('list');
  while (list.firstChild) list.removeChild(list.firstChild);
  for (let i = 0; i < state.todos.length; i++) {
    const t = state.todos[i];
    const li = document.createElement('li');
    const text = document.createElement('span');
    text.textContent = t;
    const btn = document.createElement('button');
    btn.textContent = 'âœ•';
    btn.setAttribute('aria-label', `Remove ${t}`);
    btn.addEventListener('click', function(){
      try {
        state.todos.splice(i, 1);
        render();
      } catch (error) {
        console.error('Remove todo failed:', error);
      }
    });
    li.appendChild(text);
    li.appendChild(btn);
    list.appendChild(li);
  }
</function>

<function name="addTodo">
  const input = document.getElementById('newTodo');
  const value = (input.value || '').trim();
  if (!value) return;
  <push array="state.todos" value="value"></push>
  <setprop selector="#newTodo" prop="value" value="''"></setprop>
  render();
</function>
