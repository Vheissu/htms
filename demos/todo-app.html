<!-- A tiny HTMS Todo app: compile to JS, open in a browser, and type away. -->

<var name="state" value='{"todos":[]}' mutable="true"></var>

<div id="todoApp">
  <h2>HTMS Todo</h2>
  <input type="text" id="newTodo" placeholder="Add a task" />
  <button id="addBtn">Add</button>
  <ul id="list"></ul>
</div>

<event target="#addBtn" type="click" action="addTodo()"></event>
<event target="#newTodo" type="keypress" action="onEnter(event)"></event>

<function name="onEnter" params="event">
  if (event.key === 'Enter') { addTodo(); }
  // else ignore
  return;
</function>

<function name="render">
  <setprop selector="#list" prop="textContent" value="''"></setprop>
  <append target="#list">
    <repeat variable="state.todos" index="i">
      <li>
        <span>Todo: {item}</span>
        <button class="rm" aria-label="Remove">âœ•</button>
        <event target=".rm" type="click">
          <splice array="state.todos" index="i" delete="1"></splice>
          <call function="render"></call>
        </event>
      </li>
    </repeat>
  </append>
</function>

<function name="addTodo">
  <push array="state.todos" value="document.getElementById('newTodo').value"></push>
  <setprop selector="#newTodo" prop="value" value="''"></setprop>
  render();
</function>
